{# Modèle de base #}
{% extends "base.twig" %}

{# Injection de code JavaScript #}
{% block javascript %}
	<script>
		// Libellé demandant la suppression ou non d'une tâche planifiée.
		const edit_remove = "{{ tasks_phrases["tasks_edit_remove"] }}";
	</script>
{% endblock %}

{# Contenu de la page demandé #}
{% block content %}
	{# Description de la page #}
	<p>{{ tasks_phrases["tasks_description"] }}</p>

	<section id="tasks">
		{# Titre de la section #}
		<h2>{{ header_phrases["header_subtitle_tasks"] }}</h2>

		{# Visualisation des tâches planifiées #}
		<table>
			{# En-tête du tableau #}
			<thead>
				<tr>
					<th>{{ tasks_phrases["tasks_server_label"] }}</th>
					<th>{{ tasks_phrases["tasks_date_label"] }}</th>
					<th>{{ tasks_phrases["tasks_action_label"] }}</th>
				</tr>
			</thead>

			{# Corps du tableau #}
			<tbody>
				{% for task in tasks_list %}
					<tr data-task="{{ task["task_id"] }}" class="{{ task["state"] == "DONE" ? "finished" : "" }}">
						<td>
							{# Récupération de l'indice de la boucle principale #}
							{% set indice = loop.index %}

							{# Détermination de certaines informations du serveur #}
							{% for server in tasks_servers %}
								{% if server["server_id"] == task["server_id"] %}
									{# Construction de l'adresse IP #}
									{% set address = server["admin_address"]|default(server["client_address"]) ~ ":" ~ server["admin_port"]|default(server["client_port"]) %}

									{# Nom du serveur #}
									{{ getNameByGameID(server["game_id"], address) ~ " (" ~ indice ~ ")" }}

									{# Adresse IP du serveur #}
									<em data-server="{{ server["server_id"] }}">{{ server["admin_address"]|default(server["client_address"]) ~ ":" ~ server["admin_port"]|default(server["client_port"]) }}</em>
								{% endif %}
							{% endfor %}
						</td>

						{# Date de déclenchement #}
						<td>{{ task["date"]|date("H:m | d/m/Y") }}</td>

						{# Action de déclenchement #}
						<td>{{ global_phrases["global_" ~ task["action"] ~ "_title"] }}</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>

		{# Gestion des tâches planifiées #}
		<form novalidate>
			{# Serveur concerné #}
			<div>
				<label for="server">{{ tasks_phrases["tasks_server_label"] }}</label>
				<select name="server">
					{% for server in tasks_servers %}
						<li>
							<option data-server="{{ server["server_id"] }}">{{ server["client_address"] ~ ":" ~ server["client_port"] }}</option>
						</li>
					{% endfor %}
				</select>
			</div>

			{# Date de déclenchement #}
			<div>
				<label for="date">{{ tasks_phrases["tasks_date_label"] }}</label>
				<input type="datetime-local" name="date" />
			</div>

			{# Action de réalisation #}
			<div>
				<label for="action">{{ tasks_phrases["tasks_action_label"] }}</label>
				<select name="action">
					<option value="shutdown">{{ global_phrases["global_shutdown_title"] }}</option>
					<option value="restart">{{ global_phrases["global_restart_title"] }}</option>
					<option value="update">{{ global_phrases["global_update_title"] }}</option>
					<option value="service">{{ global_phrases["global_service_title"] }}</option>
				</select>
			</div>

			{# Validation finale #}
			<input type="submit" value="{{ form_phrases["form_validate_button"] }}" />
		</form>
	</section>
{% endblock %}